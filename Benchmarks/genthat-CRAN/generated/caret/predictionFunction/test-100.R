library(caret)

function_to_run <- function() {
    x <- structure(list(Sepal.Length = c(5.1, 4.9, 4.7, 4.6, 5, 5.4, 4.6, 5, 4.4, 4.9, 5.4, 4.8, 4.8, 4.3, 5.8, 5.7, 5.4, 
        5.1, 5.7, 5.1, 5.4, 5.1, 4.6, 5.1, 4.8, 5, 5, 5.2, 5.2, 4.7, 4.8, 5.4, 5.2, 5.5, 4.9, 5, 5.5, 4.9, 4.4, 5.1, 5, 4.5, 
        4.4, 5, 5.1, 4.8, 5.1, 4.6, 5.3, 5, 7, 6.4, 6.9, 5.5, 6.5, 5.7, 6.3, 4.9, 6.6, 5.2, 5, 5.9, 6, 6.1, 5.6, 6.7, 5.6, 
        5.8, 6.2, 5.6, 5.9, 6.1, 6.3, 6.1, 6.4, 6.6, 6.8, 6.7, 6, 5.7, 5.5, 5.5, 5.8, 6, 5.4, 6, 6.7, 6.3, 5.6, 5.5, 5.5, 
        6.1, 5.8, 5, 5.6, 5.7, 5.7, 6.2, 5.1, 5.7, 6.3, 5.8, 7.1, 6.3, 6.5, 7.6, 4.9, 7.3, 6.7, 7.2, 6.5, 6.4, 6.8, 5.7, 
        5.8, 6.4, 6.5, 7.7, 7.7, 6, 6.9, 5.6, 7.7, 6.3, 6.7, 7.2, 6.2, 6.1, 6.4, 7.2, 7.4, 7.9, 6.4, 6.3, 6.1, 7.7, 6.3, 
        6.4, 6, 6.9, 6.7, 6.9, 5.8, 6.8, 6.7, 6.7, 6.3, 6.5, 6.2, 5.9), Sepal.Width = c(3.5, 3, 3.2, 3.1, 3.6, 3.9, 3.4, 
        3.4, 2.9, 3.1, 3.7, 3.4, 3, 3, 4, 4.4, 3.9, 3.5, 3.8, 3.8, 3.4, 3.7, 3.6, 3.3, 3.4, 3, 3.4, 3.5, 3.4, 3.2, 3.1, 3.4, 
        4.1, 4.2, 3.1, 3.2, 3.5, 3.6, 3, 3.4, 3.5, 2.3, 3.2, 3.5, 3.8, 3, 3.8, 3.2, 3.7, 3.3, 3.2, 3.2, 3.1, 2.3, 2.8, 2.8, 
        3.3, 2.4, 2.9, 2.7, 2, 3, 2.2, 2.9, 2.9, 3.1, 3, 2.7, 2.2, 2.5, 3.2, 2.8, 2.5, 2.8, 2.9, 3, 2.8, 3, 2.9, 2.6, 2.4, 
        2.4, 2.7, 2.7, 3, 3.4, 3.1, 2.3, 3, 2.5, 2.6, 3, 2.6, 2.3, 2.7, 3, 2.9, 2.9, 2.5, 2.8, 3.3, 2.7, 3, 2.9, 3, 3, 2.5, 
        2.9, 2.5, 3.6, 3.2, 2.7, 3, 2.5, 2.8, 3.2, 3, 3.8, 2.6, 2.2, 3.2, 2.8, 2.8, 2.7, 3.3, 3.2, 2.8, 3, 2.8, 3, 2.8, 3.8, 
        2.8, 2.8, 2.6, 3, 3.4, 3.1, 3, 3.1, 3.1, 3.1, 2.7, 3.2, 3.3, 3, 2.5, 3, 3.4, 3), Petal.Length = c(1.4, 1.4, 1.3, 
        1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.6, 1.4, 1.1, 1.2, 1.5, 1.3, 1.4, 1.7, 1.5, 1.7, 1.5, 1, 1.7, 1.9, 1.6, 
        1.6, 1.5, 1.4, 1.6, 1.6, 1.5, 1.5, 1.4, 1.5, 1.2, 1.3, 1.4, 1.3, 1.5, 1.3, 1.3, 1.3, 1.6, 1.9, 1.4, 1.6, 1.4, 1.5, 
        1.4, 4.7, 4.5, 4.9, 4, 4.6, 4.5, 4.7, 3.3, 4.6, 3.9, 3.5, 4.2, 4, 4.7, 3.6, 4.4, 4.5, 4.1, 4.5, 3.9, 4.8, 4, 4.9, 
        4.7, 4.3, 4.4, 4.8, 5, 4.5, 3.5, 3.8, 3.7, 3.9, 5.1, 4.5, 4.5, 4.7, 4.4, 4.1, 4, 4.4, 4.6, 4, 3.3, 4.2, 4.2, 4.2, 
        4.3, 3, 4.1, 6, 5.1, 5.9, 5.6, 5.8, 6.6, 4.5, 6.3, 5.8, 6.1, 5.1, 5.3, 5.5, 5, 5.1, 5.3, 5.5, 6.7, 6.9, 5, 5.7, 4.9, 
        6.7, 4.9, 5.7, 6, 4.8, 4.9, 5.6, 5.8, 6.1, 6.4, 5.6, 5.1, 5.6, 6.1, 5.6, 5.5, 4.8, 5.4, 5.6, 5.1, 5.1, 5.9, 5.7, 
        5.2, 5, 5.2, 5.4, 5.1), Petal.Width = c(0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 
        0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.4, 0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2, 0.2, 0.2, 0.4, 0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 
        0.2, 0.2, 0.3, 0.3, 0.2, 0.6, 0.4, 0.3, 0.2, 0.2, 0.2, 0.2, 1.4, 1.5, 1.5, 1.3, 1.5, 1.3, 1.6, 1, 1.3, 1.4, 1, 1.5, 
        1, 1.4, 1.3, 1.4, 1.5, 1, 1.5, 1.1, 1.8, 1.3, 1.5, 1.2, 1.3, 1.4, 1.4, 1.7, 1.5, 1, 1.1, 1, 1.2, 1.6, 1.5, 1.6, 1.5, 
        1.3, 1.3, 1.3, 1.2, 1.4, 1.2, 1, 1.3, 1.2, 1.3, 1.3, 1.1, 1.3, 2.5, 1.9, 2.1, 1.8, 2.2, 2.1, 1.7, 1.8, 1.8, 2.5, 
        2, 1.9, 2.1, 2, 2.4, 2.3, 1.8, 2.2, 2.3, 1.5, 2.3, 2, 2, 1.8, 2.1, 1.8, 1.8, 1.8, 2.1, 1.6, 1.9, 2, 2.2, 1.5, 1.4, 
        2.3, 2.4, 1.8, 1.8, 2.1, 2.4, 2.3, 1.9, 2.3, 2.5, 2.3, 1.9, 2, 2.3, 1.8)), class = "data.frame", row.names = c(NA, 
        -150L))
    subset_x <- caret:::subset_x
    submod <- NULL
    mod <- list(fit = structure(list(learn = list(y = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
        1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
        1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 
        2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 
        3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 
        3L, 3L, 3L, 3L, 3L), .Label = c("setosa", "versicolor", "virginica"), class = "factor"), X = structure(c(-0.898736942343834, 
        -1.13899335267337, -1.37924976300291, -1.49937796816768, -1.0188651475086, -0.538352326849523, -1.49937796816768, 
        -1.0188651475086, -1.73963437849722, -1.13899335267337, -0.538352326849523, -1.25912155783814, -1.25912155783814, 
        -1.85976258366199, -0.0578395061904449, -0.177967711355214, -0.538352326849523, -0.898736942343834, -0.177967711355214, 
        -0.898736942343834, -0.538352326849523, -0.898736942343834, -1.49937796816768, -0.898736942343834, -1.25912155783814, 
        -1.0188651475086, -0.778608737179063, -1.37924976300291, -1.25912155783814, -0.538352326849523, -0.778608737179063, 
        -0.418224121684754, -1.13899335267337, -1.0188651475086, -0.418224121684754, -1.13899335267337, -0.898736942343834, 
        -1.0188651475086, -1.61950617333245, -1.73963437849722, -1.0188651475086, -0.898736942343834, -0.898736942343834, 
        -1.49937796816768, -0.658480532014294, 1.38369895578679, 0.662929724798175, 1.26357075062202, -0.418224121684754, 
        0.783057929962944, -0.177967711355214, 0.542801519633404, -1.13899335267337, 0.903186135127714, -0.778608737179063, 
        -1.0188651475086, 0.0622886989743256, 0.182416904139095, 0.302545109303864, -0.298095916519985, 1.02331434029248, 
        -0.298095916519985, -0.0578395061904449, 0.422673314468635, 0.0622886989743256, 0.302545109303864, 0.542801519633404, 
        0.302545109303864, 0.662929724798175, 1.14344254545725, 1.02331434029248, 0.182416904139095, -0.177967711355214, 
        -0.418224121684754, -0.418224121684754, -0.0578395061904449, 0.182416904139095, -0.538352326849523, 0.182416904139095, 
        0.542801519633404, -0.298095916519985, -0.418224121684754, -0.0578395061904449, -1.0188651475086, -0.298095916519985, 
        -0.177967711355214, -0.177967711355214, 0.422673314468635, -0.898736942343834, -0.177967711355214, 0.542801519633404, 
        -0.0578395061904449, 1.50382716095156, 0.542801519633404, 0.783057929962944, 2.10446818677541, -1.13899335267337, 
        1.7440835712811, 1.02331434029248, 1.62395536611633, 0.783057929962944, 0.662929724798175, 1.14344254545725, -0.177967711355214, 
        -0.0578395061904449, 0.662929724798175, 0.783057929962944, 2.22459639194018, 2.22459639194018, 1.26357075062202, 
        -0.298095916519985, 2.22459639194018, 0.542801519633404, 1.02331434029248, 1.62395536611633, 0.422673314468635, 0.302545109303864, 
        0.662929724798175, 1.86421177644587, 2.46485280226972, 0.662929724798175, 0.542801519633404, 0.302545109303864, 2.22459639194018, 
        0.542801519633404, 0.662929724798175, 1.26357075062202, 1.26357075062202, -0.0578395061904449, 1.14344254545725, 
        1.02331434029248, 1.02331434029248, 0.542801519633404, 0.783057929962944, 0.0622886989743256, 0.982353270979326, 
        -0.143433584557253, 0.306881157657379, 0.0817237865500632, 1.20751064208664, 1.88298275540859, 0.75719589987201, 
        0.75719589987201, -0.368590955664569, 0.0817237865500632, 1.43266801319396, 0.75719589987201, -0.143433584557253, 
        -0.143433584557253, 2.1081401265159, 3.00876961094517, 1.88298275540859, 0.982353270979326, 1.65782538430127, 1.65782538430127, 
        0.75719589987201, 1.43266801319396, 1.20751064208664, 0.532038528764694, 0.75719589987201, -0.143433584557253, 0.75719589987201, 
        0.306881157657379, 0.0817237865500632, 0.75719589987201, 2.33329749762322, 2.55845486873054, 0.0817237865500632, 
        0.306881157657379, 0.982353270979326, 1.20751064208664, 0.75719589987201, 0.982353270979326, -1.71953518230846, 0.306881157657379, 
        0.982353270979326, 1.65782538430127, 1.65782538430127, 0.306881157657379, 1.43266801319396, 0.306881157657379, 0.306881157657379, 
        0.0817237865500632, -1.71953518230846, -0.593748326771884, -0.593748326771884, 0.532038528764694, -1.49437781120115, 
        -0.368590955664569, -0.818905697879199, -2.39500729563041, -0.143433584557253, -1.94469255341578, -0.368590955664569, 
        -0.368590955664569, 0.0817237865500632, -0.143433584557253, -0.818905697879199, -1.94469255341578, 0.306881157657379, 
        -0.593748326771884, -1.26922044009383, -0.593748326771884, -0.368590955664569, -0.593748326771884, -0.143433584557253, 
        -0.368590955664569, -1.04406306898652, -1.49437781120115, -1.49437781120115, -0.818905697879199, -0.818905697879199, 
        -0.143433584557253, 0.75719589987201, -1.71953518230846, -0.143433584557253, -1.04406306898652, -1.04406306898652, 
        -1.71953518230846, -0.818905697879199, -0.143433584557253, -0.368590955664569, -0.368590955664569, -1.26922044009383, 
        -0.593748326771884, 0.532038528764694, -0.818905697879199, -0.143433584557253, -0.368590955664569, -0.143433584557253, 
        -0.143433584557253, -1.26922044009383, -0.368590955664569, -1.26922044009383, 1.20751064208664, 0.306881157657379, 
        -0.818905697879199, -0.143433584557253, -1.26922044009383, -0.593748326771884, 0.306881157657379, -0.143433584557253, 
        1.65782538430127, -1.04406306898652, 0.306881157657379, -0.593748326771884, -0.593748326771884, -0.818905697879199, 
        0.532038528764694, 0.306881157657379, -0.593748326771884, -0.143433584557253, -0.593748326771884, -0.593748326771884, 
        1.65782538430127, -0.593748326771884, -0.593748326771884, -1.04406306898652, -0.143433584557253, 0.75719589987201, 
        0.0817237865500632, 0.0817237865500632, 0.0817237865500632, -0.818905697879199, 0.306881157657379, 0.532038528764694, 
        -0.143433584557253, -1.26922044009383, -0.143433584557253, -0.143433584557253, -1.33211598094487, -1.33211598094487, 
        -1.38843782793127, -1.27579413395848, -1.33211598094487, -1.16315043998569, -1.33211598094487, -1.27579413395848, 
        -1.33211598094487, -1.27579413395848, -1.27579413395848, -1.21947228697208, -1.33211598094487, -1.50108152190406, 
        -1.44475967491766, -1.27579413395848, -1.38843782793127, -1.33211598094487, -1.16315043998569, -1.27579413395848, 
        -1.16315043998569, -1.27579413395848, -1.55740336889045, -1.16315043998569, -1.0505067460129, -1.21947228697208, 
        -1.33211598094487, -1.21947228697208, -1.21947228697208, -1.27579413395848, -1.27579413395848, -1.33211598094487, 
        -1.27579413395848, -1.44475967491766, -1.38843782793127, -1.33211598094487, -1.27579413395848, -1.38843782793127, 
        -1.38843782793127, -1.38843782793127, -1.21947228697208, -1.0505067460129, -1.21947228697208, -1.33211598094487, 
        -1.27579413395848, 0.526504969606148, 0.413861275633359, 0.639148663578937, 0.132252040701386, 0.470183122619753, 
        0.413861275633359, 0.526504969606148, -0.262000888203376, 0.470183122619753, 0.0759301937149912, -0.149357194230587, 
        0.244895734674175, 0.132252040701386, 0.526504969606148, -0.0930353472441925, 0.357539428646964, 0.413861275633359, 
        0.18857388768778, 0.413861275633359, 0.582826816592543, 0.132252040701386, 0.639148663578937, 0.526504969606148, 
        0.30121758166057, 0.582826816592543, 0.695470510565332, 0.413861275633359, -0.149357194230587, 0.0196083467285965, 
        -0.0367135002577979, 0.0759301937149912, 0.751792357551726, 0.413861275633359, 0.413861275633359, 0.357539428646964, 
        0.18857388768778, 0.357539428646964, 0.132252040701386, -0.262000888203376, 0.244895734674175, 0.244895734674175, 
        0.244895734674175, 0.30121758166057, -0.43096642916256, 0.18857388768778, 1.25868898042928, 0.751792357551726, 1.20236713344288, 
        1.0334015924837, 1.14604528645649, 1.59662006234765, 0.413861275633359, 1.42765452138846, 1.14604528645649, 1.31501082741567, 
        0.751792357551726, 0.864436051524516, 0.977079745497305, 0.695470510565332, 0.751792357551726, 0.864436051524516, 
        0.977079745497305, 1.65294190933404, 1.76558560330683, 1.08972343947009, 0.639148663578937, 1.65294190933404, 0.639148663578937, 
        1.08972343947009, 1.25868898042928, 0.582826816592543, 0.639148663578937, 1.0334015924837, 1.31501082741567, 1.48397636837486, 
        1.0334015924837, 0.751792357551726, 1.0334015924837, 1.31501082741567, 1.0334015924837, 0.977079745497305, 0.92075789851091, 
        0.751792357551726, 0.751792357551726, 1.20236713344288, 1.08972343947009, 0.808114204538121, 0.695470510565332, 0.808114204538121, 
        0.751792357551726, -1.30801791532092, -1.30801791532092, -1.30801791532092, -1.30801791532092, -1.30801791532092, 
        -1.04699438454735, -1.17750614993414, -1.30801791532092, -1.30801791532092, -1.43852968070771, -1.30801791532092, 
        -1.30801791532092, -1.43852968070771, -1.43852968070771, -1.30801791532092, -1.04699438454735, -1.04699438454735, 
        -1.17750614993414, -1.17750614993414, -1.17750614993414, -1.30801791532092, -1.04699438454735, -1.30801791532092, 
        -0.916482619160559, -1.30801791532092, -1.30801791532092, -1.30801791532092, -1.30801791532092, -1.30801791532092, 
        -1.04699438454735, -1.43852968070771, -1.30801791532092, -1.30801791532092, -1.30801791532092, -1.30801791532092, 
        -1.43852968070771, -1.30801791532092, -1.17750614993414, -1.17750614993414, -1.30801791532092, -0.785970853773771, 
        -1.04699438454735, -1.30801791532092, -1.30801791532092, -1.30801791532092, 0.258123269320537, 0.388635034707326, 
        0.388635034707326, 0.127611503933749, 0.388635034707326, 0.127611503933749, 0.519146800094114, -0.263923792226617, 
        0.127611503933749, 0.258123269320537, -0.263923792226617, 0.388635034707326, -0.263923792226617, 0.258123269320537, 
        0.127611503933749, 0.258123269320537, 0.388635034707326, -0.263923792226617, 0.388635034707326, 0.780170330867691, 
        0.127611503933749, 0.388635034707326, -0.00290026145303991, 0.127611503933749, 0.258123269320537, 0.649658565480903, 
        0.388635034707326, -0.263923792226617, -0.133412026839828, -0.263923792226617, -0.00290026145303991, 0.519146800094114, 
        0.388635034707326, 0.519146800094114, 0.127611503933749, 0.127611503933749, -0.00290026145303991, -0.00290026145303991, 
        -0.263923792226617, 0.127611503933749, -0.00290026145303991, 0.127611503933749, 0.127611503933749, -0.133412026839828, 
        0.127611503933749, 1.69375268857521, 0.910682096254479, 1.17170562702806, 0.780170330867691, 1.30221739241485, 1.17170562702806, 
        0.649658565480903, 0.780170330867691, 0.780170330867691, 1.69375268857521, 1.04119386164127, 0.910682096254479, 1.17170562702806, 
        1.04119386164127, 1.56324092318842, 1.43272915780163, 0.780170330867691, 1.30221739241485, 1.43272915780163, 1.43272915780163, 
        1.04119386164127, 1.04119386164127, 0.780170330867691, 1.17170562702806, 0.780170330867691, 0.780170330867691, 0.780170330867691, 
        1.17170562702806, 0.910682096254479, 1.04119386164127, 1.30221739241485, 0.388635034707326, 0.258123269320537, 1.43272915780163, 
        1.56324092318842, 0.780170330867691, 1.17170562702806, 1.43272915780163, 0.910682096254479, 1.43272915780163, 1.69375268857521, 
        1.43272915780163, 0.910682096254479, 1.04119386164127, 0.780170330867691), .Dim = c(135L, 4L), .Dimnames = list(c("X1", 
        "X2", "X3", "X4", "X5", "X6", "X7", "X8", "X9", "X10", "X11", "X12", "X13", "X14", "X15", "X16", "X17", "X18", "X19", 
        "X20", "X21", "X22", "X23", "X24", "X25", "X26", "X29", "X30", "X31", "X32", "X33", "X34", "X35", "X36", "X37", "X38", 
        "X40", "X41", "X42", "X43", "X44", "X45", "X47", "X48", "X49", "X51", "X52", "X53", "X54", "X55", "X56", "X57", "X58", 
        "X59", "X60", "X61", "X62", "X63", "X64", "X65", "X66", "X67", "X68", "X69", "X71", "X72", "X73", "X74", "X75", "X77", 
        "X78", "X79", "X80", "X81", "X82", "X83", "X84", "X85", "X86", "X88", "X89", "X91", "X93", "X94", "X95", "X96", "X97", 
        "X98", "X99", "X100", "X101", "X102", "X103", "X104", "X105", "X106", "X107", "X108", "X109", "X110", "X111", "X112", 
        "X113", "X114", "X115", "X116", "X117", "X118", "X119", "X121", "X122", "X123", "X124", "X125", "X126", "X127", "X128", 
        "X129", "X131", "X132", "X133", "X134", "X135", "X136", "X137", "X138", "X140", "X142", "X143", "X144", "X145", "X146", 
        "X147", "X148", "X150"), c("Sepal.Length", "Sepal.Width", "Petal.Length", "Petal.Width")))), k = 11L, theDots = list(), 
        xNames = c("Sepal.Length", "Sepal.Width", "Petal.Length", "Petal.Width"), problemType = "Classification", tuneValue = structure(list(k = 11L), 
            row.names = 4L, class = "data.frame"), obsLevels = structure(c("setosa", "versicolor", "virginica"), ordered = FALSE), 
        param = list()), class = "knn3"), preProc = structure(list(dim = c(135L, 4L), bc = NULL, yj = NULL, et = NULL, invHyperbolicSine = NULL, 
        mean = structure(c(5.84814814814815, 3.0637037037037, 3.76518518518519, 1.20222222222222), names = c("Sepal.Length", 
            "Sepal.Width", "Petal.Length", "Petal.Width")), std = structure(c(0.832443969864016, 0.444133805205682, 1.77550995485209, 
            0.766214445905602), names = c("Sepal.Length", "Sepal.Width", "Petal.Length", "Petal.Width")), ranges = NULL, 
        rotation = NULL, method = list(center = c("Sepal.Length", "Sepal.Width", "Petal.Length", "Petal.Width"), scale = c("Sepal.Length", 
            "Sepal.Width", "Petal.Length", "Petal.Width"), ignore = character(0)), thresh = 0.95, pcaComp = NULL, numComp = NULL, 
        ica = NULL, wildcards = list(PCA = character(0), ICA = character(0)), k = 5, knnSummary = genthat::with_env(function(x, 
            ...) UseMethod("mean"), env = .BaseNamespaceEnv), bagImp = NULL, median = NULL, data = NULL, rangeBounds = c(0, 
            1), call = "scrubed"), class = "preProcess"))
    method <- list(label = "k-Nearest Neighbors", library = NULL, loop = NULL, type = c("Classification", "Regression"), 
        parameters = structure(list(parameter = structure(1L, .Label = "k", class = "factor"), class = structure(1L, .Label = "numeric", 
            class = "factor"), label = structure(1L, .Label = "#Neighbors", class = "factor")), class = "data.frame", row.names = c(NA, 
            -1L)), grid = genthat::with_env(function(x, y, len = NULL, search = "grid") {
            if (search == "grid") {
                out <- data.frame(k = (5:((2 * len) + 4))[(5:((2 * len) + 4))%%2 > 0])
            } else {
                by_val <- if (is.factor(y)) length(levels(y)) else 1
                out <- data.frame(k = sample(seq(1, floor(nrow(x)/3), by = by_val), size = len, replace = TRUE))
            }
        }, env = list2env(list(), parent = baseenv())), fit = genthat::with_env(function(x, y, wts, param, lev, last, classProbs, 
            ...) {
            if (is.factor(y)) {
                knn3(as.matrix(x), y, k = param$k, ...)
            } else {
                knnreg(as.matrix(x), y, k = param$k, ...)
            }
        }, env = list2env(list(knnreg = caret::knnreg, knn3 = caret::knn3), parent = baseenv())), predict = genthat::with_env(function(modelFit, 
            newdata, submodels = NULL) {
            if (modelFit$problemType == "Classification") {
                out <- predict(modelFit, newdata, type = "class")
            } else {
                out <- predict(modelFit, newdata)
            }
            out
        }, env = list2env(list(predict = stats::predict), parent = baseenv())), predictors = genthat::with_env(function(x, 
            ...) colnames(x$learn$X), env = list2env(list(), parent = baseenv())), tags = "Prototype Models", prob = genthat::with_env(function(modelFit, 
            newdata, submodels = NULL) predict(modelFit, newdata, type = "prob"), env = list2env(list(predict = stats::predict), 
            parent = baseenv())), levels = genthat::with_env(function(x) levels(x$learn$y), env = list2env(list(), parent = baseenv())), 
        sort = genthat::with_env(function(x) x[order(-x[, 1]), ], env = list2env(list(), parent = baseenv())))
    holdoutIndex <- c(27L, 28L, 39L, 46L, 50L, 70L, 76L, 87L, 90L, 92L, 120L, 130L, 139L, 141L, 149L)
    caret:::predictionFunction(method = method, modelFit = mod$fit, newdata = subset_x(x, holdoutIndex), preProc = mod$preProc, 
        param = submod)
}




