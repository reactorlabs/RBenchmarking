library(emplik)

function_to_run <- function() {
    myfun2 <- genthat::with_env(function(t) {
        matrix(0, ncol = ncol(AA), nrow = length(t))
    }, env = list2env(list(), parent = list2env(list(myfun2 = function(t) {
        matrix(0, ncol = ncol(AA), nrow = length(t))
    }, myfun = genthat::with_env(function(t, A) {
        return(A)
    }, env = list2env(list(), parent = baseenv())), x20 = 1:30, esort = c(22.16741247, 23.143230858, 23.267087433, 24.267087433, 
        24.729186424, 25.063243954, 25.231278867, 25.538982195, 26.935819827, 27.108351699, 27.729186424, 27.93458005, 28.267087433, 
        29.099669854, 29.766234767, 30.073008688, 30.740501305, 31.061071364, 31.16741247, 31.315101065, 33.669504913, 33.766234767, 
        33.829478721, 34.292972674, 35.309405254, 35.624509725, 35.669504913, 35.729184721, 35.729186424, 36.000770816, 36.073008688, 
        36.496043634, 36.809173328, 37.657257219, 38.458995291, 38.768557433, 38.775844316, 39.496043634, 39.496043634, 39.653536185, 
        39.834905087, 40.433727384, 40.50147, 41.664388917, 44.16741247, 45.073008688, 47.073008688, 52.267087433, 52.496043634, 
        56.50147, 58.766234767, 61.834905087, 67.50147, 68.219031173, 70.267087433, 73.458995291, 75.309405254, 76.458995291, 
        76.665320027, 87.496043634, 88.433727384, 93.729186424, 106.231278867, 109.496043634, 114.188804158), dsort = c(1, 
        1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 
        1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1), d20 = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1), AA = structure(c(-388.277500000001, -1445.6256, -1135.2852, 
        -2291.826, -868.539000000001, 298.0156, 376.0518, -202.552000000001, -1053.4975, -55.1502, -899.918800000001, 832.208, 
        -524.405, 549.6672, -301.646, 1055.838, 262.1622, 1294.648, 15.6701999999999, 486.59, -409.3569, -183.3335, -71.9745999999999, 
        -47.8598999999999, 604.1376, -108.9681, 667.287, 607.62, 188.375, 91.6176000000001, -148.7686, 143.792, 9.32190000000002, 
        -19.362, -55.1718000000001, 8.09200000000001, -74.8672, -37.3155000000001, 54.5482, -51.103, -5.08200000000001, 20.7711, 
        -3.87590000000001, 0.929400000000006, 3.89950000000001, -1.2042, -0.2184, 0), .Dim = c(48L, 1L))), parent = baseenv())))
    myfun <- genthat::with_env(function(t, A) {
        return(A)
    }, env = list2env(list(), parent = baseenv()))
    x20 <- 1:30
    esort <- c(22.16741247, 23.143230858, 23.267087433, 24.267087433, 24.729186424, 25.063243954, 25.231278867, 25.538982195, 
        26.935819827, 27.108351699, 27.729186424, 27.93458005, 28.267087433, 29.099669854, 29.766234767, 30.073008688, 30.740501305, 
        31.061071364, 31.16741247, 31.315101065, 33.669504913, 33.766234767, 33.829478721, 34.292972674, 35.309405254, 35.624509725, 
        35.669504913, 35.729184721, 35.729186424, 36.000770816, 36.073008688, 36.496043634, 36.809173328, 37.657257219, 38.458995291, 
        38.768557433, 38.775844316, 39.496043634, 39.496043634, 39.653536185, 39.834905087, 40.433727384, 40.50147, 41.664388917, 
        44.16741247, 45.073008688, 47.073008688, 52.267087433, 52.496043634, 56.50147, 58.766234767, 61.834905087, 67.50147, 
        68.219031173, 70.267087433, 73.458995291, 75.309405254, 76.458995291, 76.665320027, 87.496043634, 88.433727384, 93.729186424, 
        106.231278867, 109.496043634, 114.188804158)
    dsort <- c(1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 
        0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1)
    d20 <- c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
    AA <- structure(c(-388.277500000001, -1445.6256, -1135.2852, -2291.826, -868.539000000001, 298.0156, 376.0518, -202.552000000001, 
        -1053.4975, -55.1502, -899.918800000001, 832.208, -524.405, 549.6672, -301.646, 1055.838, 262.1622, 1294.648, 15.6701999999999, 
        486.59, -409.3569, -183.3335, -71.9745999999999, -47.8598999999999, 604.1376, -108.9681, 667.287, 607.62, 188.375, 
        91.6176000000001, -148.7686, 143.792, 9.32190000000002, -19.362, -55.1718000000001, 8.09200000000001, -74.8672, -37.3155000000001, 
        54.5482, -51.103, -5.08200000000001, 20.7711, -3.87590000000001, 0.929400000000006, 3.89950000000001, -1.2042, -0.2184, 
        0), .Dim = c(48L, 1L))
    emplik:::emplikHs.test22(x1 = esort, d1 = dsort, x2 = x20, d2 = d20, theta = rep(0, ncol(AA)), fun1 = myfun, fun2 = myfun2, 
        A = AA)
}




